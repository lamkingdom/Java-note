# Lock

## 死锁

### 产生条件

产生死锁必须同时满足以下四点：

1. 互斥，每个资源只可被一个线程所占有。
2. 占用且等待，线程1已获取资源X，在等待获取资源Y时不释放X。
3. 不可抢占，其他线程不能强行抢占线程 T1 占有的资源。
4. 循环等待，线程1等待线程2释放锁，线程2也在等待线程1释放锁。

### 解决方法

死锁产生的四个条件必须同时满足，故只要破坏其中之一即可：

对于互斥我们没办法破坏，因为锁就是互斥的。

#### 破坏占用且等待条件

只需要一次性申请所有需要的资源即可，就不存在等待了。

#### 破坏不可抢占条件

在占有资源的线程去获取其他线程时，如果获取不到就释放当前资源即可。（可能产生活锁）

#### 破坏循环等待条件

给每个资源一个序号，在获取所需资源时，先获取序号小的，再获取序号大的。

## 活锁

产生活锁的原因是两个线程一直互相让出资源，导致无法进行下去。类似生活中两个人互相迎面走来，同过一个门，A打算谦让B，走左边。B也打算谦让A，也走左边。这时两人发现都在左边又同时走向右边，如此循环下去。

**解决方法：**只需要给两人不同的随机时间在原地等待，即可解决。